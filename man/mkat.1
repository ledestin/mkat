.\"                                      Hey, EMACS: -*- nroff -*-
.\" First parameter, NAME, should be all caps
.\" Second parameter, SECTION, should be 1-8, maybe w/ subsection
.\" other parameters are allowed: see man(7), man(1)
.TH MKAT 1 "Feb 11, 2005"
.\" Please adjust this date whenever revising the manpage.
.\"
.\" Some roff macros, for reference:
.\" .nh        disable hyphenation
.\" .hy        enable hyphenation
.\" .ad l      left justify
.\" .ad b      justify to both left and right margins
.\" .nf        disable filling
.\" .fi        enable filling
.\" .br        insert line break
.\" .sp <n>    insert n+1 empty lines
.\" for manpage-specific macros, see man(7)
.SH NAME
mkat \- catalog a CD or filesystem path, then search database by file name, tags or md5 sum

.SH SYNOPSIS
\fBmkat\fR
.RI [ options ]

.SH DESCRIPTION
\fBmkat\fR can catalog a CD or a "local" filesystem directory. \fBmkat\fR
creates a .list file in $LISTDIR which contans data about CD or directory you want
cataloged.

The .list file name is named after the CD label or NO_LABEL if label 
could not be obtained
if \fBmkat\fR is called without \fB-p\fR option, or path with the leading '/'
stripped and the rest of '/'s replaced with '.'s if \fB-p\fR option is used.
The CD label is obtained from $DRIVE, which should be a cdrom device
(see \fImkatrc(5)\fR).
If you catalog a CD, its data should reside at $CD, if you catalog a
directory, path you specified with \fB-p\fR option is used.

\fB-t\fR (tag) option can be given to assign tags, which later
can be used in search with \fB-to\fR (tags only) option or ignored
with \fB-nt, -s\fR (no tags) option. The 'cd' tag will be automatically added
when cataloging a CD and 'filesystem' tag will be added when cataloging a
filesystem path.

A .list file contains CD label or filesystem path as the first line,
may contain "tags line"
as the second line, the consecutive lines contain directories and files. 
A tag line has the following format \fBtags: tag1 tag2 tagN\fR.
A file entry looks like this: \fBfilename:size:md5\fR.
Those files can be searched with a regexp using \fB-s\fR or \fB-to\fR option.
Also, mkat can obtain a md5 sum of an existing file and grep for that 
sum (\fB-m\fR option).

\fBmkat\fR is automatically called from \fBburn\fR, but if you already 
have a lot of CDs, \fBmkat -y\fR will process a CD, eject it and wait 
for keyboard input (Enter), process next CD, and so on.

If a file with the same name as the CD label already exists in $LISTDIR,
\fB-f\fR option can be used to overwrite the file.

.SH OPTIONS
.TP
.B \-f
overwrite list file
.TP
.B \-p \fI<path>\fR
catalog path instead of a CD. List file name will be path with the leading \
'/' removed and the rest of '/'s replaced with '.'
.TP
.B \-t \fI<tag[,tag]...>\fR
assign tags to the .list file
.TP
.B \-s \fI<regex>\fR
search the CD database
.TP
.B \-nt
don't search tags with -s (no tags)
.TP
.B \-to \fI<tag[,tag]...>\fR
search within tags only
.TP
.B \-m \fI<file>...\fR
make md5 sum(s) and search for them in the db
.TP
.B \-\-md5dir\fI[dir]\fR
print files in the dir recursively that aren't in the db (using mkat -m).
The dir defaults to "." (current dir).
.TP
.B \-y
cycle { mkat; eject; }
.TP
.B \-q
be quiet
.TP
.B \-h, \-\-help
Show summary of options.

.SH EXIT CODES
When given \fB-s\fR, \fB-to\fR or \fB-m\fR option mkat exit code is zero if something was
found and nonzero otherwise. Actually, exit code returned by grep(1) is
returned here.

.SH EXAMPLES
.TP
mkat -t anime,drama,comedy,school
Catalog a Fruits Basket CD with the specified tags
.TP
mkat -p ~/music/ -t music,western
Catalog a filesystem path
.TP
mkat -s 'Fruits Basket 1.+'
Search list files contents using grep regular expression
.TP
mkat -to music
Find .list files with the 'music' tag
.TP
mkat -s music -nt
Find .list files containing 'music', exclude tags from search
.TP
mkat -m unknown_stuff.avi
Find out if the specified file exists in the catalog using its md5 sum

.SH FILES
.TP
.B /etc/mkatrc, ~/.mkatrc
config files where $CD, $DRIVE, etc. are defined

.SH SEE ALSO
\fIburn(1), mkatrc(5)\fR

.SH AUTHOR
This manual page was written by Dmitry Maksyoma <ledestin@amur.ru>,
for the Debian project (but may be used by others).
